C编码规范
=========
 
一．指导思想(Guideline)
---------------------

### 1. 编码风格目的

> **原则 1：浑然一体（Coding Like One）**

统一代码风格的目的是让整个团队的代码看起来像一个人写的，这样的好处是便于交流，而且代码看起来赏心悦目。一个产品，UI好看能加分不少，而且俗话说文如其人，对于程序员而言，代码就是一切，一份整洁清晰的代码会给人一份如沐春风的感觉。

注：认可这一点是继续读下去的关键。

### 2. 破窗效应

> **原则 2：不容忍破窗户（Do not Live with Broken Windows）**

一个秩序很好的社区会应为一块破窗户而变得混乱，如果大家都无法自律，你妥协一次我妥协一次，那么整个代码都会被折腾的面目全非；而如果代码像艺术品一般，后面的修改者也不愿意破坏，会好好维护。因此对代码风格要有强迫症，必须整洁。如果无法理解，参看第一条。

### 3. 风格参考模板
命名风格与GTK+代码类似，排版风格与Linux内核代码类似。

二．命名(Naming)
--------------

> **原则3：命名，第一步很重要（Naming: First Of All）**

你会不会给自己的孩子随便起个名字，如果不会，请一样对待你的代码。

1.	面向对象的命名方式，采用“主语（对象）+谓语（动作）”的形式，取代传统的“谓语（动作）+宾语（目标）”的形式。如：`table_get_data()`
2.	文件名：单词小写，多个单词用下划线分隔。如：code_name.c
3.	函数名：单词小写，多个单词用下划线分隔。如：见1
4.	宏名：单词大写，多个单词用下划线分隔。如：`#define CODE_LENGTH 10`
5.	结构/枚举：首字母大写，多个单词连写。如：`struct UploadDataSet`;
6.	尽量使用有意义的命名，i、j、k、a、b等无意义的名字尽量少出现
7.	命名要展示对象的功能，表述清楚是关键，有了补全工具，长一点没关系。

三．排版(Layout)
--------------

> **原则4：远一点，不要暧昧（Stay Far Away，No Ambiguity）**

多一个空格不会让整个程序变大，更不会你的银行卡少100块钱。你是喜欢拥挤的筒子楼，还是喜欢松散的别墅区？所以多一些分隔，代码更清晰、整洁。

1. 等号两边使用空格，二元操作符（`>`, `<`, `&&`, `&`, `||`, `|`等）两边使用空格。如：`int a = 100;`，`if (a > b)`
2. `if`/`while`/`for`/`switch`关键字后跟一个空格。如：`while (a > b)`
3.	参数之间，for循环判断块之间使用空格。如：`test(int a, int b, int c);`以及`for (i = 0; i < cnt; i++)`
4. 新建多个同类型变量时分别在不同行新建，不要拥挤在一行。
5. 函数体之间用空行分隔。
6. 不同功能的代码块之间使用空行分隔。
7. 将功能相似的定义与声明放在一起，和其他部分使用空行分隔。
8. 判断语句中出现多级判断时，使用括号括起来，不要靠默认优先级判断；同时如果判断语句过多，分行处理。
9. 使用`{}`分隔`if`/`while`/`for`等语句的代码块，哪怕代码只有一行。如
10.	大括号`{}`的使用为`{`新开一行，不与`if`/`while`/`for`/`switch`/函数接口在同一行。
11.	注意缩进，保持美观。

四．注释(Comment)
===============

> **原则5：描述清晰接口（Comment Interface Clearly）**

### 1. 文件头注释模板。

不需要加修改历史，这些会在版本管理工具中维护，需要在文件头中详细描述的是这个文件所完成的功能。

	//*********************************************
	// Name:
	// Description:
	// Author:
	//**********************************************

### 2. 函数注释模板。

主要将函数功能以及接口描述清楚

	//*********************************************
	// Name:
	// Description:
	// Input:
	// Output:
	//**********************************************

### 3. 普通注释

风格为//后跟一个空格。

> **原则6：代码说话，注释帮忙（Code Talks, Comment Helps）**

### 4. 不要啰嗦

只对关键代码注释，过多的注释反而对维护不利，很多时候，我们在更新完代码之后没时间或者忘记更新注释，此时注释反而成了阅读代码的毒药。

五．设计(Design)
==============

### 1. 分治

> **原则7：分而治之（Divide and Conquer）**

不要把所有代码都塞到一个文件中，不要惧怕多文件，一个文件就是一类代码的集合，因此要将代码根据功能分散到不同文件中。业余的代码就是将很多没关系的代码糅到一个大文件中，结果导致文件很大，难以定位函数，同时也造成了代码混乱。

### 2. 单一职责

> **原则8：只专注于一件事（One Method, One Purpose）**

一个函数只完成单一的功能。不要用代码的长度来衡量是否要把一段代码独立成为一个函数。即使只有几行代码，只要这些代码完成的是一项独立的功能，都应该将其写成一个独立的函数，而函数名要能够直观地反应出它的功能。如果在给函数起名时遇到了困难，不要怀疑，不要犹豫，通常是函数设计不合理，则应该仔细思考一下并对函数进行相应修改。

### 3. 重复是bug的温床

> **原则9：干！不要重复自己（DRY，Do not Repeat Yourself）**

在编程时候很容易写了重复的代码，这样的坏处是容易出错，并且经不起变化。首先，在写类似代码时我们总喜欢“复制粘贴”，但使用这种方法很容易犯一些细节上的错误，如果某个地方修改的不完整，那就等于给程序中埋下一枚“不定时”的炸弹。其次，软件中唯一不变的就是变化，如果哪天你要修改重复代码所完成的功能，结果由于太困了/不细心/跟女朋友吵架而忘记修改了一处，好了，你的调试噩梦开始了。

因此，克服自己的懒惰，发现有重复的部分，花时间分析它，想办法将这些重复的代码抽取出来，不但锻炼了自己重构/设计的功力，也使程序更健壮。

### 4. 提交代码时心虚吗？

> **原则10：早测试的鸟有虫吃（Birds Who Test Early Get Bugs）**

根据上述的几个设计原则，一般能将程序模块化，这个时候就需要尽量进行单元测试。当模块通过了单元测试，在集成时才比较有底气，不会出现在心里默念“一定不要出问题“或者高呼”这不科学“的情况。

六．陷阱预防(Traps Prevention)
==============================

TODO: 包括指针内存的使用，有符号跟无符号数运算，default语句，单片机中断的使用，GPIO口在作为输入时防芯片烧毁

七．版本管理(Version Control)
=============================

### 1. 代码评审

> **原则11：评审，最后的守卫（Review，The Last Guard）**

分支的代码必须经过代码评审才能合并到主线。

### 2. 提交

> **原则12：一次只提交一个修改（One Change At A Time）**

提交代码时，一次最好只提交一个需求/问题修改，将提交粒度变细，这样的好处是在出现问题时回滚代码将会变得容易。

TODO: 不要直接在主线上操作，一个较大（或者修改文件较多）的功能最好分出一个分支，调试完成后在合并回主线。
